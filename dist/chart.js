!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).Chart=e()}(this,function(){"use strict";const t="x",e=1,s=80,i=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],n=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];function r(t){const s=new Array(t.length),i=new Array(t.length);let n=t[e],r=t[e];for(let a=e;a<t.length;a+=1){const e=t[a];n=Math.min(n,e),r=Math.max(r,e);for(let n=a+1;n<t.length&&(!i[a]&&e<t[n]&&(i[a]=n),!s[a]&&e>t[n]&&(s[a]=n),!i[a]||!s[a]);n+=1);}return{indexMax:i,indexMin:s,maxValue:r,minValue:n}}function a(s){const i={data:{},length:0,firstIndex:e,lastIndex:0,order:[],x:null};return Array.isArray(s.columns)?(s.columns.forEach(n=>{const a=n[0],h=n;s.types[a]===t?i.x=function(s,i){const n=new Array(i.length),r=new Array(i.length);for(let t=e;t<i.length;t+=1){const e=new Date(i[t]);n[t]=e,r[t]=M(e)}return{id:s,type:t,column:i,dates:n,labels:r}}(a,h):(i.order.push(a),i.data[a]={id:a,column:h,type:s.types[a],name:s.names[a],color:s.colors[a],visible:!0,...r(h)})}),i.length=i.x.column.length,i.lastIndex=i.length-1,i):null}function h(t,e,s,i){let n=s;for(;e[n]&&e[n]<=i;)n=e[n];return t[n]}function o(t,e,i,n){const{firstIndex:r,lastIndex:a}=t,o=n.width/(i[1]-i[0]);e.firstIndex=r,e.lastIndex=a,e.startIndex=Math.floor((a-r)*i[0])+r,e.endIndex=Math.ceil(a*i[1]),function(t,e,s=6){s<2?s=2:s>2&&(s-=1);const i=(1.025*e.max-e.min)/s,n=10**Math.floor(Math.log10(i)),r=n*Math.floor(i/n+.5);t.min=r*Math.floor(e.min/r),t.max=r*Math.ceil(e.max/r),t.tickStep=r}(e.axisY,function(t,e,s){let i=-1/0,n=-i;return t.order.forEach(r=>{const a=t.data[r];a.visible&&(i=Math.max(i,h(a.column,a.indexMax,e,s)),n=Math.min(n,h(a.column,a.indexMin,e,s)))}),{max:i,min:n}}(t,e.startIndex,e.endIndex));const{axisY:l}=e;e.stepX=o/a,e.stepY=n.height/(l.max-l.min),e.offsetX=-o*i[0],e.offsetY=l.min*e.stepY,function(t,e){const{firstIndex:i,lastIndex:n,startIndex:r,endIndex:a,stepX:h}=e,o=Math.round(s/h);let l=1;for(;l<o;)l*=2;let c=(n-7)%l;for(;c<i;)c+=l;let d=r-(r-c)%l;d<i&&(d+=l);const u=a-(a-c)%l;t.startIndex=d,t.endIndex=u,t.tickStep=l}(e.axisX,e)}const l=(t,e,s,i,n=0,r=0,a=0,h=0)=>({x:t,y:e,width:s,height:i,cx0:n,cy0:r,cx1:a,cy1:h});function c(t,e,s){const i=document.createElement(t);if(e&&(i.className=e),"object"==typeof s)for(const t in s)i.setAttribute(t,s[t]);return i}function d(t){return t.getContext("2d")}function u(){return window.devicePixelRatio||1}function f(t){return window.requestAnimationFrame(t)}function v(t){t.style.display="none"}function p(t){t.style.display=null}function m(t,e){t.className+=` ${e}`}function g(t,e){t.className=t.className.replace(e,"").replace(/\s/g," ").trim()}function x(t,e,s,i){e.split(",").forEach(e=>t.addEventListener(e,s,i))}function C(t,e,s){e.split(",").forEach(e=>t.removeEventListener(e,s))}function b(t){return(t.touches?t.touches[0]:t).pageX}function $(t){if(t.touches){const e=t.touches[0],s=e.target.getBoundingClientRect();return e.clientX-s.left}return t.offsetX}function w(t,e){e.forEach(e=>{e in t&&(t[e]=t[e].bind(t))})}function M(t){return`${i[t.getUTCMonth()]} ${t.getUTCDate()}`}var y={"-webkit-filter":"tch-1_Qgx",filter:"tch-1_Qgx",checkbox:"tch-37oPe",light:"tch-xefpZ",dark:"tch-otI1W",input:"tch-yqUE1",icon:"tch-1IpOz"};class S{constructor(t,e,s){this.themeName=s,this.dataset=t,this.$el=c("div",`${y.filter} ${y[s]}`),this.render(),this.$el.addEventListener("change",({target:{name:t,checked:s}})=>e(t,s))}setTheme(t){g(this.$el,y[this.themeName]),m(this.$el,y[t]),this.themeName=t}render(){const{data:t,order:e}=this.dataset;this.$el.innerHTML=e.reduce((e,s)=>e+function(t,e){const s=`<input class="${y.input}" name="${t}" type="checkbox" ${e.visible?"checked":""}>`,i=`<div class="${y.icon}" style="color:${e.color}"></div>`;return`<label class="${y.checkbox}">${s}${i}${e.name}</label>`}(s,t[s]),"")}}const E=[45,120,195,270,345,420].reverse(),I=u();function k(t){t.scale(I,I)}function H(t,e){t.save(),k(t),t.clearRect(e.x-e.cx0,e.y-e.cy0,e.width+e.cx0+e.cx1,e.height+e.cy0+e.cy1),t.restore()}function T(t,e,s,i,n=2){const{startIndex:r,endIndex:a,stepX:h,stepY:o,offsetX:l,offsetY:c}=s;t.save(),t.setTransform(I,0,0,-I,(l+i.x)*I,(c+i.height+i.y)*I),t.lineJoin="round",t.lineWidth=n,e.order.forEach(s=>{const{color:i,column:n,visible:l}=e.data[s];if(l){t.beginPath(),t.strokeStyle=i,t.moveTo(r*h,n[r]*o);for(let e=r+1;e<=a;e+=1)t.lineTo(e*h,n[e]*o);t.stroke()}}),t.restore()}var X={scroll:"tch-iTusj",leftHand:"tch-34oNu",rightHand:"tch-3GcYT",centerHand:"tch-7WkGf",cursorGrabbing:"tch-1OYIo"};const N={[X.leftHand]:!0,[X.rightHand]:!0,[X.centerHand]:!0},P=6;class D{constructor(t,e,s,i){this.ctx=t,Object.assign(this,function(){const t=c("div",X.scroll),e=c("div",X.leftHand),s=c("div",X.rightHand),i=c("div",X.centerHand);return t.appendChild(e),t.appendChild(s),t.appendChild(i),{$el:t,$leftHand:e,$rightHand:s,$centerHand:i}}()),this.range=e,this.minRange=s,this.state={left:0,right:0},this.activeControl=null,this.prevPageX=null,this.onChange=i,w(this,["handleMove","handleMoveEnd","handleMoveStart"]),x(this.$el,"mousedown,touchstart",this.handleMoveStart)}destroy(){this.activeControl=null,this.detachMoveEvents(),C(window,"mousedown,touchstart",this.handleMoveStart)}update(){const{offsetHeight:t,offsetTop:e,offsetWidth:s}=this.$el;this.vp=l(0,e,s,t),this.width=this.vp.width-2*P,this.leftMin=P,this.rightMax=this.width+P,this.updateState(),this.redrawSlider(),this.redrawControls()}updateState(){this.state.left=Math.round(this.range[0]*this.width)+P,this.state.right=Math.round(this.range[1]*this.width)+P,this.state.minWidth=Math.round(this.minRange*this.width)}updateRange(){this.range[0]=(this.state.left-P)/this.width,this.range[1]=(this.state.right-P)/this.width}attachMoveEvents(){x(window,"mousemove,touchmove",this.handleMove),x(window,"mouseup,touchend,touchcancel",this.handleMoveEnd)}detachMoveEvents(){C(window,"mousemove,touchmove",this.handleMove),C(window,"mouseup,touchend,touchcancel",this.handleMoveEnd)}handleMoveStart(t){const{className:e}=t.target;N[e]&&(this.activeControl=e,this.prevPageX=b(t),this.attachMoveEvents(),v(this.$el),m(this.$el.parentNode,X.cursorGrabbing))}handleMove(t){const e=b(t)-this.prevPageX;if(e){const t=this.applyDelta(e);t&&(this.prevPageX+=t,this.updateRange(),this.onChange(this.range))}}handleMoveEnd(){this.activeControl=null,this.detachMoveEvents(),this.redrawControls(),p(this.$el),g(this.$el.parentNode,X.cursorGrabbing)}applyDelta(t){const{left:e,right:s,minWidth:i}=this.state,n=s-e;let r=t,a=e,h=s;return this.activeControl===X.leftHand?((a+=t)>s-i?a=s-i:a<this.leftMin&&(a=this.leftMin),r=a-e):this.activeControl===X.rightHand?((h+=t)<e+i?h=e+i:h>this.rightMax&&(h=this.rightMax),r=h-s):this.activeControl===X.centerHand&&(a+=t,(h+=t)>this.rightMax?a=(h=this.rightMax)-n:a<this.leftMin&&(h=(a=this.leftMin)+n),r=a-e),this.state.left=a,this.state.right=h,r}redrawSlider(){!function(t,e,s,i,n){const r=e.right-e.left,a=r+2*s;H(t,i),t.save(),k(t),t.fillStyle=n.fadeColor,t.fillRect(i.x,i.y,i.width,i.height),t.fillStyle=n.sliderColor,t.clearRect(e.left-s,i.y,a,i.height),t.fillRect(e.left-s,i.y,a,i.height),t.clearRect(e.left,i.y+2,r,i.height-4),t.restore()}(this.ctx,this.state,P,this.vp,this.theme)}redrawControls(){const{left:t,right:e}=this.state;this.$leftHand.style.left=`${t-P}px`,this.$rightHand.style.left=`${e}px`,this.$centerHand.style.left=`${t}px`,this.$centerHand.style.width=`${e-t}px`}}var A={chartWrap:"tch-13R36",light:"tch-2n1OX",bubble:"tch-3NMVD",dark:"tch-23c8o",noData:"tch-3MF8u",header:"tch-3lmAk",charts:"tch-3KEDM",canvas:"tch-3MU0P",cursorZone:"tch-1IxmZ",bubbleDate:"tch-s4zYX",bubbleContent:"tch-3M7g5",bubbleItem:"tch-1d5Lj",bubbleVal:"tch-2qwdV"};const Y={fontFamily:'"HelveticaNeue-Light", "Helvetica Neue Light", "Helvetica Light", Helvetica, Arial , Verdana, sans-serif',fontSize:"15px"},W=Object.assign({},Y,{backgroundColor:"#ffffff",cursorColor:"#E0E6EA",gridColor:"#f4f4f4",labelColor:"#929EA6",fadeColor:"rgba(242,246,250,0.7)",sliderColor:"rgba(100,144,177,0.4)"}),R=Object.assign({},Y,{backgroundColor:"#262F3D",cursorColor:"#3E4A59",gridColor:"#333D4C",labelColor:"#586776",fadeColor:"rgba(28,37,50,0.8)",sliderColor:"rgba(100,144,177,0.4)"});var F=Object.freeze({light:W,dark:R});function Z(t,e){const s=`<div class="${A.bubbleDate}">${i=t.x.dates[e],`${n[i.getUTCDay()]}, ${M(i)}`}</div>`;var i;let r="";t.order.forEach(s=>{const i=t.data[s];i.visible&&(r+=`<div class="${A.bubbleItem}" style="color: ${i.color};"><div class="${A.bubbleVal}">${i.column[e]}</div>${i.name}</div>`)});const a=`<div class="${A.bubbleContent}">${r}</div>`;return`<div class="${A.bubbleWrap}">${s}${a}</div>`}return class{constructor(t,e,s,i){w(this,["handleFilterChange","handleScrollChange"]),this.themeName=i,this.theme=F[i],this.dataset=a(s),this.state={axisY:{},axisX:{}},this.previewState={axisY:{},axisX:{}},Object.assign(this,function(t){const e=c("div",`${A.chartWrap} ${A[t]}`),s=c("div",A.header),i=c("div",A.charts),n=c("canvas",A.canvas),r=c("canvas",A.canvas),a=c("div",A.cursorZone),h=c("div",A.bubble),o=c("div",A.noData);return o.innerText="No data to view",v(h),v(o),a.appendChild(h),i.appendChild(n),i.appendChild(r),i.appendChild(a),i.appendChild(o),e.appendChild(s),e.appendChild(i),{$el:e,$header:s,$charts:i,$chartsCanvas:n,$deskCanvas:r,$cursorZone:a,$bubble:h,$noData:o}}(i)),t.appendChild(this.$el),this.chartsCtx=d(this.$chartsCanvas),this.deskCtx=d(this.$deskCanvas),this.$header.innerText=e,this.scroll=new D(this.deskCtx,[.75,1],.01,this.handleScrollChange),this.scroll.theme=this.theme,this.$charts.appendChild(this.scroll.$el),this.filter=new S(this.dataset,this.handleFilterChange,i),this.$el.appendChild(this.filter.$el),w(this,["handleCursorStart","handleCursorMove","handleCursorEnd"]),this.showCursor=!1,this.cursorIndex=null,x(this.$cursorZone,"mouseenter,touchstart",this.handleCursorStart),this.update(),this.redrawPreview(),this.redrawCharts()}destroy(){this.scroll.destroy(),this.detachCursorEvents()}setTheme(t){g(this.$el,A[this.themeName]),m(this.$el,A[t]),this.theme=F[t],this.themeName=t,this.scroll.theme=this.theme,this.filter.setTheme(t),this.update(),this.redrawPreview(),this.redrawCharts()}setHeader(t){this.$header.innerText=t}handleFilterChange(t,e){this.dataset.data[t].visible=e;let s=!1;this.dataset.order.forEach(t=>{s=s||this.dataset.data[t].visible}),s?(v(this.$noData),this.redrawCharts(),this.redrawPreview()):p(this.$noData)}handleScrollChange(){this.redrawCharts()}attachCursorEvents(){x(this.$cursorZone,"mousemove,touchmove",this.handleCursorMove),x(this.$cursorZone,"mouseleave,touchend,touchcancel",this.handleCursorEnd)}detachCursorEvents(){C(this.$cursorZone,"mousemove,touchmove",this.handleCursorMove),C(this.$cursorZone,"mouseleave,touchend,touchcancel",this.handleCursorEnd)}handleCursorStart(t){this.showCursor=!0,this.attachCursorEvents(),this.moveCursor($(t))}handleCursorMove(t){this.showCursor?this.moveCursor($(t)):this.hideCursor()}handleCursorEnd(){this.hideCursor()}update(){this.updateScene(),this.redrawCharts(),this.redrawPreview()}updateScene(){const{offsetHeight:t,offsetWidth:e}=this.$chartsCanvas,s=u();[this.$chartsCanvas,this.$deskCanvas].forEach(i=>{i.height=t*s,i.width=e*s}),this.vp={grid:l(0,0,e,450),charts:l(0,0,e,420,0,0,0,10),preview:l(0,t-55,e,50,0,10,0,10)},this.scroll.update()}updateState(){o(this.dataset,this.state,this.scroll.range,this.vp.charts)}updatePreviewState(){o(this.dataset,this.previewState,[0,1],this.vp.preview)}moveCursor(t){const{deskCtx:e,dataset:s,state:i,vp:n,theme:r}=this;f(()=>{let a=Math.round((t-i.offsetX)/i.stepX);a<i.startIndex?a=i.startIndex:a>i.endIndex&&(a=i.endIndex),this.cursorIndex!==a&&(this.cursorIndex=a,this.redrawBubble(),function(t,e,s,i,n,r){const{stepX:a,stepY:h,offsetX:o,offsetY:l}=s;H(t,n),t.save(),t.setTransform(I,0,0,I,(o+n.x)*I,n.y*I);const c=i*a;t.beginPath(),t.strokeStyle=r.cursorColor,t.moveTo(c,0),t.lineTo(c,n.height),t.stroke(),t.setTransform(I,0,0,-I,(o+n.x)*I,(l+n.height+n.y)*I),e.order.forEach(s=>{const n=e.data[s];n.visible&&(t.beginPath(),t.strokeStyle=n.color,t.lineWidth="3",t.fillStyle=r.backgroundColor,t.arc(c,n.column[i]*h,6,0,2*Math.PI),t.fill(),t.stroke())}),t.restore()}(e,s,i,a,n.charts,r))})}hideCursor(){const{deskCtx:t,vp:e}=this;this.showCursor=!1,this.cursorIndex=null,this.detachCursorEvents(),v(this.$bubble),f(()=>{H(t,e.charts)})}redrawBubble(){const{$bubble:t,dataset:e,state:s,cursorIndex:i,vp:n}=this;if(!this.showCursor)return;p(t),t.innerHTML=Z(e,i);const r=t.offsetWidth,a=Math.round(r/2);let h=Math.round(s.stepX*i+s.offsetX)-a;h<0?h=0:h>n.charts.width-r&&(h=n.charts.width-r),t.style.left=`${h}px`}redrawCharts(){const{chartsCtx:t,dataset:e,state:s,vp:i,theme:n}=this;f(r=>{this.updateState(r),this.scroll.redrawSlider(),H(t,i.grid),function(t,e,s){t.save(),k(t),t.lineWidth=1===I?2:1.5,t.strokeStyle=s.gridColor,t.beginPath(),E.forEach(s=>{t.moveTo(e.x,s+e.y),t.lineTo(e.width,s+e.y)}),t.stroke(),t.restore()}(t,i.grid,n),T(t,e,s,i.charts,3),function(t,{axisY:e},s,i){t.save(),k(t),t.fillStyle=i.labelColor,t.font=`${i.fontSize} ${i.fontFamily}`,E.forEach((i,n)=>{t.fillText(e.min+e.tickStep*n,s.x,i-7+s.y)}),t.restore()}(t,s,i.grid,n),function(t,e,{axisX:s,offsetX:i,stepX:n},r,a){t.save(),t.setTransform(I,0,0,I,(i+r.x)*I,440*I),t.fillStyle=a.labelColor,t.textAlign="center",t.font=`${a.fontSize} ${a.fontFamily}`;for(let i=s.startIndex;i<=s.endIndex;i+=s.tickStep)t.fillText(e[i],i*n,0);t.restore()}(t,e.x.labels,s,i.grid,n)})}redrawPreview(){const{chartsCtx:t,dataset:e,previewState:s,vp:i}=this;f(n=>{s.min;const r=s.max;this.updatePreviewState(n),r!==s.max||s.min,H(t,i.preview),T(t,e,s,i.preview)})}}});
